/* shortcodes.js v1.0.0 | https://github.com/stamat/shortcodes.js | MIT License */
function shallowMerge(e,t){for(const r in t)e[r]=t[r]}function _cloneObject(e){let t={};for(const r in e)t[r]=clone(e[r]);return t}function _cloneArray(e){let t=[];for(var r=0;r<e.length;r++)t[r]=clone(e[r]);return t}function clone(e){let t=null;return t=Array.isArray(e)?_cloneArray(e):"object"==typeof e&&null!==e?_cloneObject(e):e,t}function insertBeforeElement(e,t){var r;null==(r=e.parentNode)||r.insertBefore(t,e)}function removeAll(e){for(const t of document.querySelectorAll(e))t.remove()}var Shortcodes=class{constructor(e){this.descriptor_index={},this.exec_fns={},this.shopify_img_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(_[0-9]+x[0-9]*)(\.[a-z]{3,4}.*)$/gi,this.shopify_img_replacer_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(\.[a-z]{3,4}.*)$/gi,this.attribute_re=/(\w+)*?\s*(?:([\w\-_]+)=?(?:"([^"]+)"|'([^']+)')*)\s*/gi,this.shortcode_re=this.options={templates:"#templates",template_class:"template",self_anchor_class:"self-anchor",placement_class_prefix:"shortcode-landing"},e&&shallowMerge(this.options,e)}shopifyImageLink(e,t){let r="$2";t||(t=100);let n=this.shopify_img_replacer_re;if(!n.test(e))return e;this.shopify_img_re.test(e)&&(r="$3",n=this.shopify_img_re);const s=`$1_${t}x${r}`;return e.replace(n,s)}parseDOM(e,t){const r={};let n=null;const s=e.children,o=/\[([\/a-z0-9\-_="'\s]+)\]/gi;let a=0;for(let e=0;e<s.length;e++){const i=s[e];let c=null;if(!(i instanceof HTMLPreElement||i.querySelector("pre"))){const e=i.textContent.toLowerCase().trim();c=o.exec(e),o.lastIndex=0}if(c&&c.length>1){if(0===c[1].indexOf("/")&&n&&n.indexOf(c[1].replace(/^\//,""))>-1){n=null,i.remove();continue}n=`${c[1]} sc${a}`;const e=document.createElement("div");e.className=`${this.options.self_anchor_class} shortcode-${n.split(/\s+/)[0]} sc${a}`,r.hasOwnProperty(n)||(r[n]=[],a++),insertBeforeElement(i,e),r[n].push(e),i.remove()}else if(n&&r[n].push(i),t&&n!==t&&r.hasOwnProperty(t))return r[t]}return t&&r.hasOwnProperty(t)?r[t]:r}};Shortcodes.prototype.sortDOM=function(e,t){var r=/^\{([a-z0-9\-_\s]+)\}$/gi,n=[],s={},o={},a=0,i=null,c=null,l=null,p=0,h=!1;function f(){m(),p+=1}s.rest=[];var _={},u={};function m(){for(var e in u)s[e].push(null);u=function(){for(var e in res={},_)res[e]=!0;return res}()}if(e.hasOwnProperty("elements"))for(var d in e.elements)"rest"!==d&&(c=d,s.hasOwnProperty(d)||(s[d]=[]),null===i&&(i=d),o.hasOwnProperty(d)||(o[d]=!0,a++)),_[d]=!0,u[d]=!0;for(var y=0;y<t.length;y++){var g=$(t[y]);if(g.hasClass("self-anchor"))"self"===e.anchor&&(e.anchor=g);else if(g.is("img")||""!==g.html().trim()){var x=!1;if(e.hasOwnProperty("item_template")){var v=g.text().toLowerCase().trim(),b=r.exec(v);if(r.lastIndex=0,b&&b.length>1){(p||h)&&f(),n[p]=b[1],h=!0;continue}}if(a)for(var d in o)if(s[d].length!==e.elements[d].count&&("img"!==d||!g.find("li").length)){var w=g.find(d);if(g.is(d)||w.length){w.length&&(g=w.first()),e.hasOwnProperty("item_template")&&!u.hasOwnProperty(d)&&f(),s[d].push(g),e.hasOwnProperty("item_template")&&delete u[d],x=!0;break}}x||(e.hasOwnProperty("item_template")?(s.rest[p]||(delete u.rest,s.rest[p]=[]),s.rest[p].push(g[0])):s.rest.push(g[0]))}}e.hasOwnProperty("item_template")&&m();var O=null;for(var d in o){var P=s[d].length;(null===l||P>O)&&(l=d,O=P)}return{elements:s,item_tags:n,first_element_key:i,last_element_key:c,max_element_key:l}},Shortcodes.prototype.executeProperties=function(e,t,r,n,s){if("attr"===r.extract_fn)if("string"==typeof r.extract_attr)extract=e[r.extract_fn](r.extract_attr),e.is("img")&&"src"===r.extract_attr&&extract&&this.shopify_img_re.test(extract)&&(extract=extract.replace(this.shopify_img_re,"$1$3"));else{extract=[];for(var o=0;o<r.extract_attr.length;o++)if("html"!==r.extract_attr[o]){if(e.is("img")&&"src"===r.extract_attr[o]){var a=e.attr("src");if(a&&this.shopify_img_re.test(a)){extract.push(a.replace(this.shopify_img_re,"$1$3"));continue}}var i=r.extract_attr[o];extract.push(e[r.extract_fn](i))}else extract.push(e.html())}else"self"===r.extract_fn?extract=e:extract=e[r.extract_fn]();if(r.hasOwnProperty("parse")&&("function"==typeof r.parse?extract=r.parse(extract):window.hasOwnProperty(r.parse)&&(extract=window[r.parse](extract))),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")&&"background-image"===r.bind_property)extract="url("+extract+")";else if("function"==typeof r.bind_fn)return void r.bind_fn(extract,t,r,n,s);switch(r.anchor_element){case"item":case"template":$target=t.find(r.anchor),t.is(r.anchor)&&0===$target.length&&($target=t),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")?$target[r.bind_fn](r.bind_property,extract):$target[r.bind_fn](extract);break;default:$target=$(n.anchor).find(r.anchor),$(n.anchor).is(r.anchor)&&0===$target.length&&($target=$(n.anchor)),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")?$target[r.bind_fn](r.bind_property,extract):$target[r.bind_fn](extract)}},Shortcodes.prototype.bind=function(e,t,r){var n=null;e.hasOwnProperty("template")&&(n=this.getTemplate(e.template));var s=this.sortDOM(e,t);if(e.hasOwnProperty("item_template"))for(var o=0;o<s.elements[s.max_element_key].length;o++){var a=this.getTemplate(e.item_template);for(var i in s.item_tags[o]&&a.addClass(s.item_tags[o]),e.elements){var c=e.elements[i];if(s.elements[i][o]){var l=$(s.elements[i][o]);this.executeProperties(l,a,c,e,o)}}var p=e.hasOwnProperty("template")?n.find(e.item_anchor):$(e.anchor);"function"==typeof e.bind_fn?e.bind_fn(a,p,e,r,o):p[e.bind_fn](a)}else if(e.hasOwnProperty("elements"))for(var i in e.elements){c=e.elements[i];if(s.elements.hasOwnProperty(i))for(o=0;o<s.elements[i].length;o++){l=$(s.elements[i][o]),p=e.hasOwnProperty("template")?n:$(e.anchor);this.executeProperties(l,p,c,e,o)}}else{p=e.hasOwnProperty("template")?n:$(e.anchor);"function"==typeof e.bind_fn?e.bind_fn(s.elements.rest,p,e,r):p[e.bind_fn](s.elements.rest)}return e.hasOwnProperty("template")?("function"==typeof e.bind_fn?e.bind_fn(n,$(e.anchor),e,r):$(e.anchor)[e.bind_fn](n),n):$(e.anchor)},Shortcodes.prototype.getTemplate=function(e){var t=$(this.options.templates).find(e+"."+this.options.template_class).clone();return t.removeClass(this.options.template_class),t},Shortcodes.prototype.parseAttribute=function(e){var t={name:null,value:null},r=e.split("=");return 2===r.length&&(t.name=r[0].trim(),t.value=r[1].trim()),t},Shortcodes.prototype.parseAttributes=function(e,t){var r=this;const n={classes:[],css:{},attrs:{}},s={header:function(e,t,r){let n=null;t.hasOwnProperty("header_selector")&&t.header_selector&&(n=document.querySelector(t.header_selector)),n||document.querySelector("header"),n||document.querySelector("body"),n.classList.add(e.join("-"))},placement:function(e,t,n){e[0]&&("content"===e[0]?t.anchor="self":t.anchor="."+r.options.placement_class_prefix+"-"+e[0])},background:function(e,t,r){e[0]&&"color"===e[0]&&e[1]?n.css["background-color"]="#"+e[1]:n.classes.push(r)},color:function(e,t,r){e[0]?n.css.color=e[0]:n.classes.push(r)}};if(e.hasOwnProperty("attribute_parsers"))for(var o in e.attribute_parsers)s[o]=e.attribute_parsers[o];for(var a=0;a<t.length;a++){var i=t[a].trim().toLowerCase();if(!/sc[0-9]+/gi.test(i)){var c=i.split("-");c[0]&&s.hasOwnProperty(c[0])?s[c.shift()](c,e,i):n.classes.push(i)}}return n},Shortcodes.prototype.register=function(e,t){this.descriptor_index[e]=t;var r=this;this.exec_fns[e]=function(e,t,n){const s=clone(r.descriptor_index[e]),o=r.parseAttributes(s,t);console.log(o),s.hasOwnProperty("pre")&&s.pre&&"function"==typeof s.pre&&s.pre(s,t,n,o);var a=r.bind(s,n,o);a.addClass(o.classes.join(" ")),a.css(o.css),a.addClass("shortcode-js"),s.hasOwnProperty("callback")&&s.callback&&s.callback(a,o,s)}},Shortcodes.prototype.execute=function(e,t){e.style.visibility="hidden";const r=this.parseDOM(e);for(var n in r){const e=n.split(/\s+/gi),t=e.shift();this.exec_fns.hasOwnProperty(t)&&this.exec_fns[t](t,e,r[n])}e.style.visibility="visible",t&&t(r,this.exec_fns)},Shortcodes.prototype.clear=function(){removeAll(".shortcode-js"),removeAll(".self-anchor")},Shortcodes.prototype.reinitialize=function(e,t){this.clear(),this.execute(e,t)};