/* shortcodes.js v1.0.0 | https://github.com/stamat/shortcodes.js | MIT License */
function shallowMerge(e,t){for(const r in t)e[r]=t[r]}function _cloneObject(e){let t={};for(const r in e)t[r]=clone(e[r]);return t}function _cloneArray(e){let t=[];for(var r=0;r<e.length;r++)t[r]=clone(e[r]);return t}function clone(e){let t=null;return t=Array.isArray(e)?_cloneArray(e):"object"==typeof e&&null!==e?_cloneObject(e):e,t}function insertBeforeElement(e,t){var r;null==(r=e.parentNode)||r.insertBefore(t,e)}function removeAll(e){for(const t of document.querySelectorAll(e))t.remove()}function isFunction(e){return e&&"function"==typeof e}function propertyIsFunction(e,t){return e.hasOwnProperty(t)&&isFunction(e[t])}function transformDashToCamelCase(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))}function css(e,t,r=!1){for(let n in t)r&&(n=transformDashToCamelCase(n)),e.style[n]=t[n]}function parseAttributes(e){const t=/^\s*([a-z_]{1}[a-z0-9\-_]*)\s*$/i,r=/^\s*([a-z_]{1}[a-z0-9\-_]*)=("[^"]+"|'[^']+')\s*$/i,n=/^["']|["']$/g,s={},o=e.match(/\s*(?:([a-z_]{1}[a-z0-9\-_]*)=?(?:"([^"]+)"|'([^']+)')*)\s*/gi);for(let e=0;e<o.length;e++){const i=o[e];if(""!==i)if(t.test(i)){const[,e]=i.match(t);s[e]=null,t.lastIndex=0}else if(r.test(i)){const[,e,t]=i.match(r);s[e]=t.replace(n,""),n.lastIndex=0,r.lastIndex=0}}return s}function getShortcodeContent(e){const t=e.match(/\[([^\[\]]+)\]/i);return t?t[1]:null}function isSpecificClosingTag(e,t){return new RegExp(`^\\/\\s*${t}\\s*$`,"i").test(e)}function getShortcodeName(e){const t=e.match(/^\s*([a-z_]{1}[a-z0-9\-_]*)\s*/i);return t?t[1]:null}var Shortcodes=class{constructor(e){this.descriptor_index={},this.exec_fns={},this.shopify_img_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(_[0-9]+x[0-9]*)(\.[a-z]{3,4}.*)$/gi,this.shopify_img_replacer_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(\.[a-z]{3,4}.*)$/gi,this.options={template_class:"template",self_anchor_class:"self-anchor",placement_class_prefix:"shortcode-landing"},e&&shallowMerge(this.options,e)}shopifyImageLink(e,t){let r="$2";t||(t=100);let n=this.shopify_img_replacer_re;if(!n.test(e))return e;this.shopify_img_re.test(e)&&(r="$3",n=this.shopify_img_re);const s=`$1_${t}x${r}`;return e.replace(n,s)}createSelfAnchor(e,t,r,n){const s=document.createElement("div"),o=[];return t&&o.push(t),r&&o.push(`shortcode-${r}`),n&&o.push(`${r}-sc-${n}`),s.className=o.join(" "),insertBeforeElement(e,s),s}iterateNode(e,t,r){const n={},s=e.children;let o=null,i=0;for(let e=0;e<s.length;e++){const a=s[e];let c=null;if(!(a instanceof HTMLPreElement||a.querySelector("pre"))){c=getShortcodeContent(a.textContent.trim()),c&&!t.hasOwnProperty(getShortcodeName(c))&&(c=null)}if(c){if(o&&isSpecificClosingTag(c,o.name)){o=null,a.remove();continue}o=new Shortcode(c,clone(t[getShortcodeName(c)]),i);const e=this.createSelfAnchor(a,r,o.name,i);n.hasOwnProperty(o.uid)||(n[o.uid]=o,i++),n[o.uid].content.push(e),a.remove()}else o.uid&&n[o.uid].content.push(a)}return n}};Shortcodes.prototype.sortDOM=function(e,t){var r=/^\{([a-z0-9\-_\s]+)\}$/gi,n=[],s={},o={},i=0,a=null,c=null,l=null,h=0,p=!1;function f(){_(),h+=1}s.rest=[];var u={},d={};function _(){for(var e in d)s[e].push(null);d=function(){for(var e in res={},u)res[e]=!0;return res}()}if(e.hasOwnProperty("elements"))for(var m in e.elements)"rest"!==m&&(c=m,s.hasOwnProperty(m)||(s[m]=[]),null===a&&(a=m),o.hasOwnProperty(m)||(o[m]=!0,i++)),u[m]=!0,d[m]=!0;for(var y=0;y<t.length;y++){var g=$(t[y]);if(g.hasClass(this.options.self_anchor_class))"self"===e.anchor&&(e.anchor=g);else if(g.is("img")||""!==g.html().trim()){var x=!1;if(e.hasOwnProperty("item_template")){var b=g.text().toLowerCase().trim(),v=r.exec(b);if(r.lastIndex=0,v&&v.length>1){(h||p)&&f(),n[h]=v[1],p=!0;continue}}if(i)for(var m in o)if(s[m].length!==e.elements[m].count&&("img"!==m||!g.find("li").length)){var w=g.find(m);if(g.is(m)||w.length){w.length&&(g=w.first()),e.hasOwnProperty("item_template")&&!d.hasOwnProperty(m)&&f(),s[m].push(g),e.hasOwnProperty("item_template")&&delete d[m],x=!0;break}}x||(e.hasOwnProperty("item_template")?(s.rest[h]||(delete d.rest,s.rest[h]=[]),s.rest[h].push(g[0])):s.rest.push(g[0]))}}e.hasOwnProperty("item_template")&&_();var O=null;for(var m in o){var P=s[m].length;(null===l||P>O)&&(l=m,O=P)}return{elements:s,item_tags:n,first_element_key:a,last_element_key:c,max_element_key:l}},Shortcodes.prototype.executeProperties=function(e,t,r,n,s){if("attr"===r.extract_fn)if("string"==typeof r.extract_attr)extract=e[r.extract_fn](r.extract_attr),e.is("img")&&"src"===r.extract_attr&&extract&&this.shopify_img_re.test(extract)&&(extract=extract.replace(this.shopify_img_re,"$1$3"));else{extract=[];for(var o=0;o<r.extract_attr.length;o++)if("html"!==r.extract_attr[o]){if(e.is("img")&&"src"===r.extract_attr[o]){var i=e.attr("src");if(i&&this.shopify_img_re.test(i)){extract.push(i.replace(this.shopify_img_re,"$1$3"));continue}}var a=r.extract_attr[o];extract.push(e[r.extract_fn](a))}else extract.push(e.html())}else"self"===r.extract_fn?extract=e:extract=e[r.extract_fn]();if(r.hasOwnProperty("parse")&&("function"==typeof r.parse?extract=r.parse(extract):window.hasOwnProperty(r.parse)&&(extract=window[r.parse](extract))),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")&&"background-image"===r.bind_property)extract="url("+extract+")";else if("function"==typeof r.bind_fn)return void r.bind_fn(extract,t,r,n,s);switch(r.anchor_element){case"item":case"template":$target=t.find(r.anchor),t.is(r.anchor)&&0===$target.length&&($target=t),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")?$target[r.bind_fn](r.bind_property,extract):$target[r.bind_fn](extract);break;default:$target=$(n.anchor).find(r.anchor),$(n.anchor).is(r.anchor)&&0===$target.length&&($target=$(n.anchor)),"css"===r.bind_fn&&r.hasOwnProperty("bind_property")?$target[r.bind_fn](r.bind_property,extract):$target[r.bind_fn](extract)}},Shortcodes.prototype.construct=function(e,t,r){var n=null;e.hasOwnProperty("template")&&(n=$(this.getTemplate(e.template)));var s=this.sortDOM(e,t);if(e.hasOwnProperty("item_template"))for(var o=0;o<s.elements[s.max_element_key].length;o++){var i=$(this.getTemplate(e.item_template));for(var a in s.item_tags[o]&&i.addClass(s.item_tags[o]),e.elements){var c=e.elements[a];if(s.elements[a][o]){var l=$(s.elements[a][o]);this.executeProperties(l,i,c,e,o)}}var h=e.hasOwnProperty("template")?n.find(e.item_anchor):$(e.anchor);"function"==typeof e.bind_fn?e.bind_fn(i,h,e,r,o):h[e.bind_fn](i)}else if(e.hasOwnProperty("elements"))for(var a in e.elements){c=e.elements[a];if(s.elements.hasOwnProperty(a))for(o=0;o<s.elements[a].length;o++){l=$(s.elements[a][o]),h=e.hasOwnProperty("template")?n:$(e.anchor);this.executeProperties(l,h,c,e,o)}}else{h=e.hasOwnProperty("template")?n:$(e.anchor);"function"==typeof e.bind_fn?e.bind_fn(s.elements.rest,h,e,r):propertyIsFunction(h,e.bind_fn)&&h[e.bind_fn](s.elements.rest)}return e.hasOwnProperty("template")?("function"==typeof e.bind_fn?e.bind_fn(n,$(e.anchor),e,r):$(e.anchor)[e.bind_fn](n),n[0]):document.querySelector(e.anchor)},Shortcodes.prototype.getTemplate=function(e){e=[e],this.options.template_class&&e.push(`.${this.options.template_class}`);const t=document.querySelector(e.join("")).cloneNode(!0);return t.classList.remove(this.options.template_class),t.removeAttribute("hidden"),t.removeAttribute("aria-hidden"),t},Shortcodes.prototype.register=function(e,t){this.descriptor_index[e]=t;const r=this;this.exec_fns[e]=function(e){e.executeAttributes(),propertyIsFunction(e.descriptor,"pre")&&e.descriptor.pre(e);const t=r.construct(e.descriptor,e.content,e);t&&(e.classes.length&&t.classList.add(e.classes.join(" ")),css(t,e.css),t.classList.add("shortcode-js")),propertyIsFunction(e.descriptor,"callback")&&e.descriptor.callback($(t),e)}},Shortcodes.prototype.execute=function(e,t){e.style.visibility="hidden";const r=this.iterateNode(e,this.descriptor_index,this.options.self_anchor_class);for(let e in r){const t=r[e].name;console.log(t),this.exec_fns.hasOwnProperty(t)&&this.exec_fns[t](r[e])}e.style.visibility="visible",t&&t(r,this.exec_fns)},Shortcodes.prototype.clear=function(){removeAll(".shortcode-js"),removeAll(".self-anchor")},Shortcodes.prototype.reinitialize=function(e,t){this.clear(),this.execute(e,t)};var Shortcode=class{constructor(e,t,r,n){const s=getShortcodeName(e),o=parseAttributes(e);delete o[s],this.tag_content=e,this.uid=`${s}-sc-${r}`,this.name=s,this.attributes=o,this.descriptor=clone(t),this.content=[],this.counter=r,this.classes=[],this.css={},this.options={placement_class_prefix:"shortcode-landing"},n&&shallowMerge(this.options,n)}executeAttributes(){var e=this;const t={"header-class":function(e,t){let r=null;e.descriptor.hasOwnProperty("header_selector")&&e.descriptor.header_selector&&(r=document.querySelector(e.descriptor.header_selector)),r||(r=document.querySelector("header")),r||(r=document.querySelector("body")),r.classList.add(t)},"body-class":function(e,t){document.querySelector("body").classList.add(t)},placement:function(t,r){t.descriptor.anchor="content"!==r?"."+e.options.placement_class_prefix+"-"+r:"self"},"background-color":function(e,t){e.css.backgroundColor=t},"background-image":function(e,t){e.css.backgroundImage=`url(${t})`},color:function(e,t){e.css.color=t}};if(this.descriptor.hasOwnProperty("attribute_parsers"))for(var r in this.descriptor.attribute_parsers)propertyIsFunction(this.descriptor.attribute_parsers,r)&&(t[r]=this.descriptor.attribute_parsers[r]);for(let e in this.attributes){const r=this.attributes[e];t.hasOwnProperty(e)&&r?t[e](this,r):this.classes.push(e)}return this}};