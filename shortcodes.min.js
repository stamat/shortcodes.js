/* shortcodes.js v1.0.0 | https://github.com/stamat/shortcodes.js | MIT License */
function parseAttributes(e){const t=/^\s*([a-z_]{1}[a-z0-9\-_]*)\s*$/i,n=/^\s*([a-z_]{1}[a-z0-9\-_]*)=("[^"]+"|'[^']+')\s*$/i,r=/^["']|["']$/g,s={},o=e.match(/\s*(?:([a-z_]{1}[a-z0-9\-_]*)=?(?:"([^"]+)"|'([^']+)')*)\s*/gi);for(let e=0;e<o.length;e++){const i=o[e];if(""!==i)if(t.test(i)){const[,e]=i.match(t);s[e]=null,t.lastIndex=0}else if(n.test(i)){const[,e,t]=i.match(n);s[e]=t.replace(r,""),r.lastIndex=0,n.lastIndex=0}}return s}function shallowMerge(e,t){for(const n in t)e[n]=t[n]}function clone(e){let t=null;if(isArray(e)){t=[];for(const n in e)t[n]=clone(e[n])}else if(isObject(e)){t={};for(const n in e)t[n]=clone(e[n])}else t=e;return t}function isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}function isArray(e){return Array.isArray(e)}function isString(e){return"string"==typeof e}function isFunction(e){return"function"==typeof e}function propertyIsFunction(e,t){return e.hasOwnProperty(t)&&isFunction(e[t])}function propertyIsString(e,t){return e.hasOwnProperty(t)&&isString(e[t])}function transformDashToCamelCase(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))}function hasOwnProperties(e,t){isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))return!1;return!0}function isEmptyElement(e){return""===e.innerHTML.trim()}function remove(e,t=document){const n=query(e,t);for(const e of n)e.remove()}function query(e,t=document){if(e instanceof Array||e instanceof NodeList)return e;if(e instanceof Element)return[e];if(t instanceof Element||t instanceof Document)return t.querySelectorAll(e);if(isString(t)&&(t=query(t)),!t instanceof Array&&!t instanceof NodeList)return[];const n=[];for(const r of t)n.push(...r.querySelectorAll(e));return n}function css(e,t,n=!1){if(e&&t)for(let r in t)n&&(r=transformDashToCamelCase(r)),e.style[r]=t[r]}function decodeHTML(e){const t=document.createElement("textarea");t.innerHTML=e;const n=t.value;return t.remove(),n}function insertBeforeElement(e,t){e&&t&&e.parentNode.insertBefore(t,e)}function matchesAll(e,t){if(!e||!t||!e.length)return!1;e instanceof Element&&(e=[e]),isString(e)&&(e=query(e));for(const n of e)if(!n.matches(t))return!1;return!0}function getShortcodeContent(e){const t=e.match(/\[([^\[\]]+)\]/i);return t?t[1]:null}function isSpecificClosingTag(e,t){return new RegExp(`^\\/\\s*${t}\\s*$`,"i").test(e)}function getShortcodeName(e){const t=e.match(/^\s*([a-z_]{1}[a-z0-9\-_]*)\s*/i);return t?t[1]:null}var Shortcodes=class{constructor(e){this.descriptor_index={},this.exec_fns={},this.shopify_img_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(_[0-9]+x[0-9]*)(\.[a-z]{3,4}.*)$/gi,this.shopify_img_replacer_re=/^([a-z\.:\/]+\.shopify\.[a-z0-9\/_\-]+)(\.[a-z]{3,4}.*)$/gi,this.options={template_class:"template",self_anchor_class:"self-anchor",placement_class_prefix:"shortcode-landing"},e&&shallowMerge(this.options,e)}shopifyImageLink(e,t){let n="$2";t||(t=100);let r=this.shopify_img_replacer_re;if(!r.test(e))return e;this.shopify_img_re.test(e)&&(n="$3",r=this.shopify_img_re);const s=`$1_${t}x${n}`;return e.replace(r,s)}createSelfAnchor(e,t,n,r){const s=document.createElement("div"),o=[];return t&&o.push(t),n&&o.push(`shortcode-${n}`),r&&o.push(`${n}-sc-${r}`),s.className=o.join(" "),insertBeforeElement(e,s),s}iterateNode(e,t,n){const r={},s=e.children;let o=null,i=0;for(let e=0;e<s.length;e++){const c=s[e];let l=null;if(!(c instanceof HTMLPreElement||c.querySelector("pre"))){l=getShortcodeContent(decodeHTML(c.textContent.trim())),l&&!t.hasOwnProperty(getShortcodeName(l))&&(l=null)}if(l){if(o&&isSpecificClosingTag(l,o.name)){o=null,c.remove();continue}o=new Shortcode(l,clone(t[getShortcodeName(l)]),i);const e=this.createSelfAnchor(c,n,o.name,i);r.hasOwnProperty(o.uid)||(r[o.uid]=o,i++),r[o.uid].content.push(e),c.remove()}else o.uid&&r[o.uid].content.push(c)}return r}};Shortcodes.prototype.sortDOM=function(e){const t=e.descriptor,n=e.content,r=/^\s*\{\s*([a-z0-9\-_\s]+)\s*\}\s*$/gi,s=[],o={},i={};let c=0,l=null,a=null,p=null,h=0,f=!1;function u(){y(),h+=1}o.rest=[];const d={};let m={};function y(){for(const e in m)o[e].push(null);m=function(){res={};for(const e in d)res[e]=!0;return res}()}if(t.hasOwnProperty("elements"))for(const e in t.elements)"rest"!==e&&(a=e,o.hasOwnProperty(e)||(o[e]=[]),null===l&&(l=e),i.hasOwnProperty(e)||(i[e]=!0,c++)),d[e]=!0,m[e]=!0;for(let e=0;e<n.length;e++){let l=n[e];if(l.classList.contains(this.options.self_anchor_class)){"self"===t.anchor&&(t.anchor=l);continue}if(!l.matches("img")&&isEmptyElement(l))continue;let a=!1;if(t.hasOwnProperty("item_template")){var _=l.textContent.trim(),g=r.exec(_);if(r.lastIndex=0,g&&g.length>1){(h||f)&&u(),s[h]=g[1],f=!0;continue}}if(c)for(const e in i){if(o[e].length===t.elements[e].count)continue;if("img"===e&&l.querySelectorAll("li").length)continue;const n=l.querySelector(e);if(l.matches(e)||n){n&&(l=n),t.hasOwnProperty("item_template")&&!m.hasOwnProperty(e)&&u(),o[e].push(l),t.hasOwnProperty("item_template")&&delete m[e],a=!0;break}}a||(t.hasOwnProperty("item_template")?(o.rest[h]||(delete m.rest,o.rest[h]=[]),o.rest[h].push(l)):o.rest.push(l))}t.hasOwnProperty("item_template")&&y();let x=null;for(const e in i){var S=o[e].length;(null===p||S>x)&&(p=e,x=S)}return{elements:o,item_tags:s,first_element_key:l,last_element_key:a,max_element_key:p}},Shortcodes.prototype.constructElements=function(e,t,n,r,s){const o=r.descriptor,i=n.extract?this.extract(e,n.extract):null;if(i&&(console.log(e),matchesAll(e,"img")&&i.hasOwnProperty("src")&&this.shopify_img_re.test(i.src)&&(i.src=i.src.replace(this.shopify_img_re,"$1$3")),propertyIsFunction(n,"parse_extracted")?n.parse(i,e,t,n,r,s):propertyIsString(n,"parse_extracted")&&propertyIsFunction(window,n.parse_extracted)&&window[n.parse_extracted](i,e,t,n,r,s),n.hasOwnProperty("bind_extracted"))){isArray(n.bind_extracted)||(n.bind_extracted=[n.bind_extracted]),n.hasOwnProperty("anchor_element")?finalDestination=query(n.anchor,t):finalDestination=query(n.anchor,o.anchor),!finalDestination.length&&t.matches(n.anchor)&&(finalDestination=t),finalDestination instanceof Element&&(finalDestination=[finalDestination]);for(let e=0;e<finalDestination.length;e++)this.bindElement(finalDestination[e],n.bind_extracted,i,n,r,s)}},Shortcodes.prototype.construct=function(e){let t=null;e.descriptor.hasOwnProperty("template")&&(t=this.getTemplate(e.descriptor.template));const n=this.sortDOM(e);if(e.descriptor.hasOwnProperty("item_template"))for(let s=0;s<n.elements[n.max_element_key].length;s++){const o=this.getTemplate(e.descriptor.item_template);n.item_tags[s]&&o.classList.add(n.item_tags[s]);for(const t in e.descriptor.elements){var r=e.descriptor.elements[t];if(n.elements[t][s]){const i=n.elements[t][s];this.constructElements(i,o,r,e,s)}}const i=e.descriptor.hasOwnProperty("template")?t.querySelectorAll(e.descriptor.item_anchor):document.querySelectorAll(descriptor.anchor);this.bindShortcode(o,i,e.descriptor.bind_fn,e.descriptor.bind_property,e,s)}else if(e.descriptor.hasOwnProperty("elements"))for(const s in e.descriptor.elements){r=e.descriptor.elements[s];if(n.elements.hasOwnProperty(s))for(let o=0;o<n.elements[s].length;o++){const i=n.elements[s][o],c=e.descriptor.hasOwnProperty("template")?t:document.querySelectorAll(e.descriptor.anchor);this.constructElements(i,c,r,e,o)}}else{const r=e.descriptor.hasOwnProperty("template")?t:document.querySelectorAll(e.descriptor.anchor);this.bindShortcode(n.elements.rest,r,e.descriptor.bind_fn,e.descriptor.bind_property,e)}return e.descriptor.hasOwnProperty("template")?(this.bindShortcode(t,e.descriptor.anchor,e.descriptor.bind_fn,e.descriptor.bind_property,e),t):document.querySelector(e.descriptor.anchor)},Shortcodes.prototype.getTemplate=function(e){e=[e],this.options.template_class&&e.push(`.${this.options.template_class}`);const t=document.querySelector(e.join("")).cloneNode(!0);return t.classList.remove(this.options.template_class),t.removeAttribute("hidden"),t.removeAttribute("aria-hidden"),t},Shortcodes.prototype.register=function(e,t){this.descriptor_index[e]=t;const n=this;this.exec_fns[e]=function(e){e.executeAttributes(),propertyIsFunction(e.descriptor,"pre")&&e.descriptor.pre(e);const t=n.construct(e);t&&(e.classes.length&&t.classList.add(e.classes.join(" ")),css(t,e.css),t.classList.add("shortcode-js")),propertyIsFunction(e.descriptor,"callback")&&e.descriptor.callback(t,e)}},Shortcodes.prototype.execute=function(e,t){e.style.visibility="hidden";const n=this.iterateNode(e,this.descriptor_index,this.options.self_anchor_class);for(const e in n){const t=n[e].name;this.exec_fns.hasOwnProperty(t)&&this.exec_fns[t](n[e])}e.style.visibility="visible",t&&t(n,this.exec_fns)},Shortcodes.prototype.clear=function(){remove(".shortcode-js"),remove(".self-anchor")},Shortcodes.prototype.reinitialize=function(e,t){this.clear(),this.execute(e,t)},Shortcodes.prototype.bindElement=function(e,t,n,r,s,o){isString(e)&&(e=querySingle(e)),isString(t)&&(t=[t]);const i={append:function(e,t,n){if(n.hasOwnProperty("self")){n.self instanceof HTMLElement&&(n.self=[n.self]);for(let t=0;t<n.self.length;t++)e.appendChild(n.self[t])}},prepend:function(e,t,n){if(n.hasOwnProperty("self")){n.self instanceof HTMLElement&&(n.self=[n.self]);for(let t=0;t<n.self.length;t++)e.firstChild?e.insertBefore(n.self[t],e.firstChild):e.appendChild(n.self[t])}},html:function(e,t,n){n.hasOwnProperty("html")&&(e.innerHTML=n.html)},text:function(e,t,n){n.hasOwnProperty("text")&&(e.textContent=n.text)},style:function(e,t,n){isArray(t)||(t=[t]);for(let r=0;r<t.length;r++){if(!isObject(t[r])||!hasOwnProperties(t[r],"style_property","extracted_property"))continue;const s=transformDashToCamelCase(t[r].style_property);if(!n.hasOwnProperty(t[r].extracted_property))continue;let o=n[t[r].extracted_property];"backgroundImage"===s&&(o=`url(${o})`),e.style[s]=o}}};for(let c=0;c<t.length;c++)i.hasOwnProperty(t[c])?i[t[c]](e,t[c],n):isFunction(t[c])?t[c](e,n,r,s,o):isObject(t[c])?i.style(e,t[c],n):e.setAttribute(t[c],n[t[c]])},Shortcodes.prototype.bindShortcode=function(e,t,n,r,s,o){if("string"==typeof t?t=query(t):t instanceof HTMLElement&&(t=[t]),"string"==typeof e?e=query(e):e instanceof HTMLElement&&(e=[e]),isFunction(n))return void n(e,t,r,s,o);const i={style:function(e,t,n,r,s){"string"==typeof n&&(n=[n]);for(let r=0;r<n.length;r++){const s=transformDashToCamelCase(n[r]);t.style[s]=e.style[s]}},html:function(e,t,n,r,s){t.innerHTML=e.innerHTML},text:function(e,t,n,r,s){t.textContent=e.textContent},prepend:function(e,t,n,r,s){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},append:function(e,t,n,r,s){t.appendChild(e)}};if(t.length)for(let c=0;c<t.length;c++)for(let l=0;l<e.length;l++)i.hasOwnProperty(n)&&i[n](e[l],t[c],r,s,o)},Shortcodes.prototype.extract=function(e,t){"string"==typeof e&&(e=querySingle(e)),"string"==typeof t&&(t=[t]);const n={},r={};n.html=function(e,t){r.html=e.innerHTML},n.text=function(e,t){r.text=e.textContent},n.self=function(e,t){r.self=e},n.style=function(e,n){if(hasOwnProperties(t[i],["name","properties"])&&"style"!==!n.name){isArray(n.properties)||(n.properties=[n.properties]),r.style={};for(let t=0;t<n.properties.length;t++){const s=transformDashToCamelCase(n.properties[t]);r.style[n.properties[t]]=e.style[s]}}},n.function=function(e,t){hasOwnProperties(t,["name","extract_fn"])&&isFunction(t.extract_fn)&&(r[t.name]=t.extract_fn(e))};for(let s=0;s<t.length;s++)n.hasOwnProperty(t[s])?n[t[s]](e,t[s]):isObject(t[s])?(n.function(e,t[s]),n.style(e,t[s])):r[t[s]]=e.getAttribute(t[s]);return r};var Shortcode=class{constructor(e,t,n,r){const s=getShortcodeName(e),o=parseAttributes(e);delete o[s],this.tag_content=e,this.uid=`${s}-sc-${n}`,this.name=s,this.attributes=o,this.descriptor=clone(t),this.content=[],this.counter=n,this.classes=[],this.css={},this.options={placement_class_prefix:"shortcode-landing"},r&&shallowMerge(this.options,r)}executeAttributes(){var e=this;const t={"header-class":function(e,t){let n=null;e.descriptor.hasOwnProperty("header_selector")&&e.descriptor.header_selector&&(n=document.querySelector(e.descriptor.header_selector)),n||(n=document.querySelector("header")),n||(n=document.querySelector("body")),n.classList.add(t)},"body-class":function(e,t){document.querySelector("body").classList.add(t)},placement:function(t,n){t.descriptor.anchor="content"!==n?"."+e.options.placement_class_prefix+"-"+n:"self"},"background-color":function(e,t){e.css.backgroundColor=t},"background-image":function(e,t){e.css.backgroundImage=`url(${t})`},color:function(e,t){e.css.color=t}};if(this.descriptor.hasOwnProperty("attribute_parsers"))for(const e in this.descriptor.attribute_parsers)propertyIsFunction(this.descriptor.attribute_parsers,e)&&(t[e]=this.descriptor.attribute_parsers[e]);for(const e in this.attributes){const n=this.attributes[e];t.hasOwnProperty(e)&&n?t[e](this,n):this.classes.push(e)}return this}};